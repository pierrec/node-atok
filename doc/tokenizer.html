<head>
  <script>
    var raw = [{"id":"4-1353393114763","name":"Atok","signiture":"Atok()","type":"function","ctx":{"type":"function","name":"Atok","string":"Atok()"},"description":{"full":"<p>An atok stream</p>","summary":"<p>An atok stream</p>","body":""},"full_description":"<p>An atok stream</p>","code":"function Atok (options) {\n  if (!(this instanceof Atok))\n    return new Atok(options)\n\n  // Possible events are defined at instanciation for better performance\n  EV.call(this, Atok.events)\n  this.writable = true\n  this.readable = true\n\n  // Options\n  options = options || {}\n  this._encoding = null\n  if (options.encoding) this.setEncoding( options.encoding )\n\n  // Initializations\n  // Debug flag\n  this.debugMode = false\n\n  // Status flags\n  this.ended = false        // Flag indicating stream has ended\n  this.ending = false       // Set when end() invokes write()\n  this.paused = false       // Flag indicating stream is paused\n  this.needDrain = false    // Flag indicating stream needs drain\n\n// include(\"Atok_properties.js\")\n  // Public properties\n  this.buffer = null\n  this.length = 0\n  this.offset = 0\n  this.markedOffset = -1    // Flag indicating whether the buffer should be kept when write() ends\n\n  // Private properties\n  this._firstRule = null        // Initial rule to be triggered\n  this._resetRule = false       // Rule set was changed\n  this._stringDecoder = this._encoding ? new StringDecoder(this._encoding) : null\n  this._rulesToResolve = false  // Rules need to be resolved (continue() prop)\n  this._rulesToLink = false     // Rules need to be relinked (after a rule set change)\n  this._group = -1\n  this._groupStart = 0\n  this._groupEnd = 0\n  this._groupStartPrev = []\n\n\n    this._rules = []              // Rules to be checked against\n    this._defaultHandler = null   // Matched token default handler\n    this._savedRules = {}         // Saved rules\n\n// include(\"Atok_rule_properties.js\")\n  this._p_ignore = false        // Get the token size and skip\n  this._p_quiet = false         // Get the token size and call the handler with no data\n  this._p_escape = false        // Pattern must not be escaped\n  this._p_trimLeft = true       // Remove the left pattern from the token\n  this._p_trimRight = true      // Remove the right pattern from the token\n  this._p_next = null           // Next rule to load\n  this._p_nextIndex = 0         // Index for the next rule to load\n  this._p_continue = null       // Next rule index to load\n  this._p_continueOnFail = null // Next rule index to load when rule fails\n  this._p_break = false         // Abort current rule set\n\n  this._defaultProps = Object.keys(this)\n    .filter(function (prop) {\n      return /^_p_/.test(prop) && !/(continueOnFail|nextIndex)$/.test(prop)\n    })\n    .map(function (prop) {\n      return prop.substr(3)\n    })\n}\ninherits(Atok, EV, Stream.prototype)\n\n// Atok.prototype.__defineGetter__('currentRule', function () {\n//   return this._firstRule ? this._firstRule.currentRule : null\n// })\n\nAtok.prototype._error = function (err) {\n  this.readable = false\n  this.writable = false\n\n  this.emit_error(err)\n\n  return this\n}\n\n// include(\"methods_misc.js\")","params":[{"type":"param","types":["Object="],"name":"atok","description":"stream options"}],"has_params":true,"tags":[{"type":"param","types":["Object="],"name":"atok","description":"stream options"},{"type":"constructor","string":""}],"module":true,"related":{"href":""},"has_related":true,"methods":[{"id":"5-1353393114763","name":"clear","signiture":"Atok.prototype.clear()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"clear","string":"Atok.prototype.clear()"},"description":{"full":"<p>Reset the tokenizer by clearing its buffer and rules</p>","summary":"<p>Reset the tokenizer by clearing its buffer and rules</p>","body":""},"full_description":"<p>Reset the tokenizer by clearing its buffer and rules</p>","code":"Atok.prototype.clear = function (keepRules) {\n// include(\"Atok_properties.js\")\n  // Public properties\n  this.buffer = null\n  this.length = 0\n  this.offset = 0\n  this.markedOffset = -1    // Flag indicating whether the buffer should be kept when write() ends\n\n  // Private properties\n  this._firstRule = null        // Initial rule to be triggered\n  this._resetRule = false       // Rule set was changed\n  this._stringDecoder = this._encoding ? new StringDecoder(this._encoding) : null\n  this._rulesToResolve = false  // Rules need to be resolved (continue() prop)\n  this._rulesToLink = false     // Rules need to be relinked (after a rule set change)\n  this._group = -1\n  this._groupStart = 0\n  this._groupEnd = 0\n  this._groupStartPrev = []\n\n\n  if (!keepRules) {\n\n    this._rules = []              // Rules to be checked against\n    this._defaultHandler = null   // Matched token default handler\n    this._savedRules = {}         // Saved rules\n\n  }\n\n  this.clearProps()\n\n  return this\n}","params":[{"type":"param","types":["boolean"],"name":"keep","description":"rules set (default=false)"}],"has_params":true,"tags":[{"type":"param","types":["boolean"],"name":"keep","description":"rules set (default=false)"},{"type":"return","types":["Atok"],"description":""},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"6-1353393114763","name":"slice","signiture":"Atok.prototype.slice()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"slice","string":"Atok.prototype.slice()"},"description":{"full":"<p>Extract data from the buffer (Atok#slice)</p>","summary":"<p>Extract data from the buffer (Atok#slice)</p>","body":""},"full_description":"<p>Extract data from the buffer (Atok#slice)</p>","code":"Atok.prototype.slice = function (start, end) {\n  return this.buffer.slice(start, end)\n}","params":[{"type":"param","types":["number"],"name":"starting","description":"index"},{"type":"param","types":["number"],"name":"ending","description":"index"}],"has_params":true,"tags":[{"type":"param","types":["number"],"name":"starting","description":"index"},{"type":"param","types":["number"],"name":"ending","description":"index"},{"type":"return","types":["Object"],"description":"extracted data"},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"7-1353393114763","name":"flush","signiture":"Atok.prototype.flush()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"flush","string":"Atok.prototype.flush()"},"description":{"full":"<p>Terminate the current tokenizing and return the current buffer</p>","summary":"<p>Terminate the current tokenizing and return the current buffer</p>","body":""},"full_description":"<p>Terminate the current tokenizing and return the current buffer</p>","code":"Atok.prototype.flush = function () {\n  var data = this.slice()\n  \n  this.clear(true) // Keep rules!\n\n  return data\n}","params":[],"has_params":false,"tags":[{"type":"return","types":["Object"],"description":"left over data"},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"8-1353393114763","name":"setEncoding","signiture":"Atok.prototype.setEncoding()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"setEncoding","string":"Atok.prototype.setEncoding()"},"description":{"full":"<p>Set the string encoding</p>","summary":"<p>Set the string encoding</p>","body":""},"full_description":"<p>Set the string encoding</p>","code":"Atok.prototype.setEncoding = function (enc) {\n  switch ( String(enc) ) {\n    case 'null':\n    case 'undefined':\n      this._encoding = null\n    break\n    case 'UTF-8':\n    case 'utf-8':\n    case 'utf8':\n    default:\n      this._encoding = 'UTF-8'\n  }\n  this._stringDecoder = this._encoding\n    ? new StringDecoder(this._encoding)\n    : null\n\n  return this\n}","params":[{"type":"param","types":["string"],"name":"encoding","description":"to be used"}],"has_params":true,"tags":[{"type":"param","types":["string"],"name":"encoding","description":"to be used"},{"type":"return","types":["Atok"],"description":""},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"9-1353393114763","name":"debug","signiture":"Atok.prototype.debug()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"debug","string":"Atok.prototype.debug()"},"description":{"full":"<p>Turn debug mode on or off. Emits the [debug] event.<br />The #loadRuleSet method is also put in debug mode.<br />All handlers log their arguments.</p>","summary":"<p>Turn debug mode on or off. Emits the [debug] event.<br />The #loadRuleSet method is also put in debug mode.<br />All handlers log their arguments.</p>","body":""},"full_description":"<p>Turn debug mode on or off. Emits the [debug] event. The #loadRuleSet method is also put in debug mode. All handlers log their arguments.</p>","code":"Atok.prototype.debug = function (flag) {\n  var _debug = !!flag\n\n  // Nothing to do if already in same mode\n  if (_debug === this.debugMode) return this\n  this.debugMode = _debug\n\n  // Apply debug mode to all defined rules...\n  var self = this\n  this._rulesForEach(function (rule) {\n    rule.setDebug(_debug, self)\n  })\n\n  // Apply debug mode to some methods\n  ;[ 'loadRuleSet' ].forEach(function (method) {\n    if (_debug) {\n      var prevMethod = self[method]\n\n      self[method] = function () {\n        self.emit_debug( 'Atok#', method, arguments )\n        return prevMethod.apply(self, arguments)\n      }\n    } else {\n      // Restore the prototype method\n      delete self[method]\n    }\n  })\n\n  return this\n}","params":[{"type":"param","types":["boolean"],"name":"toggle","description":"debug mode on and off"}],"has_params":true,"tags":[{"type":"param","types":["boolean"],"name":"toggle","description":"debug mode on and off"},{"type":"return","types":["Atok"],"description":""},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"10-1353393114763","name":"currentRule","signiture":"Atok.prototype.currentRule()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"currentRule","string":"Atok.prototype.currentRule()"},"description":{"full":"<p>Get the current rule set name</p>","summary":"<p>Get the current rule set name</p>","body":""},"full_description":"<p>Get the current rule set name</p>","code":"Atok.prototype.currentRule = function () {\n  return this._firstRule ? this._firstRule.currentRule : null\n}// include(\"methods_ruleprops.js\")","params":[],"has_params":false,"tags":[{"type":"return","types":["String"],"description":"rule set name"},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"11-1353393114763","name":"setDefaultHandler","signiture":"Atok.prototype.setDefaultHandler()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"setDefaultHandler","string":"Atok.prototype.setDefaultHandler()"},"description":{"full":"<p>Set the default handler.<br />Triggered on all subsequently defined rules if the handler is not supplied</p>","summary":"<p>Set the default handler.<br />Triggered on all subsequently defined rules if the handler is not supplied</p>","body":""},"full_description":"<p>Set the default handler. Triggered on all subsequently defined rules if the handler is not supplied</p>","code":"Atok.prototype.setDefaultHandler = function (handler) {\n  this._defaultHandler = typeof handler === 'function' ? handler : null\n  return this\n}","params":[{"type":"param","types":["function(string",""],"name":"number,","description":"string|null)} rules handler (it is better to name it for debugging)"}],"has_params":true,"tags":[{"type":"param","types":["function(string",""],"name":"number,","description":"string|null)} rules handler (it is better to name it for debugging)"},{"type":"","string":"handler is called with (token, index, type)"},{"type":"return","types":["Atok"],"description":""},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"12-1353393114763","name":"next","signiture":"Atok.prototype.next()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"next","string":"Atok.prototype.next()"},"description":{"full":"<p>Skip matched data silently for all subsequent rules</p>","summary":"<p>Skip matched data silently for all subsequent rules</p>","body":""},"full_description":"<p>Skip matched data silently for all subsequent rules</p>","code":"Atok.prototype.next = function (ruleSet, index) {\n  this._p_next = typeof ruleSet === 'string' ? ruleSet : null\n  this._p_nextIndex = typeof index === 'number' ? index : 0\n  return this\n}","params":[{"type":"param","types":["string"],"name":"name","description":"of the rule set to load if rule successful"},{"type":"param","types":["number"],"name":"index","description":"to start at"}],"has_params":true,"tags":[{"type":"param","types":["string"],"name":"name","description":"of the rule set to load if rule successful"},{"type":"param","types":["number"],"name":"index","description":"to start at"},{"type":"return","types":["Atok"],"description":""},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"13-1353393114763","name":"ignore","signiture":"Atok.prototype.ignore()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"ignore","string":"Atok.prototype.ignore()"},"description":{"full":"<p>Skip matched data silently for all subsequent rules</p>","summary":"<p>Skip matched data silently for all subsequent rules</p>","body":""},"full_description":"<p>Skip matched data silently for all subsequent rules</p>","code":"Atok.prototype.ignore = function (flag) {\n  this._p_ignore = (flag === true)\n  return this\n}","params":[{"type":"param","types":["boolean","undefined"],"name":"flag","description":""}],"has_params":true,"tags":[{"type":"param","types":["boolean","undefined"],"name":"flag","description":""},{"type":"return","types":["Atok"],"description":""},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"14-1353393114763","name":"quiet","signiture":"Atok.prototype.quiet()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"quiet","string":"Atok.prototype.quiet()"},"description":{"full":"<p>Do not supply matched data to the handler for all subsequent rules.<br />This is used when the token data does not matter but a handler <br />still needs to be called. Faster than standard handler call.</p>","summary":"<p>Do not supply matched data to the handler for all subsequent rules.<br />This is used when the token data does not matter but a handler <br />still needs to be called. Faster than standard handler call.</p>","body":""},"full_description":"<p>Do not supply matched data to the handler for all subsequent rules. This is used when the token data does not matter but a handler  still needs to be called. Faster than standard handler call.</p>","code":"Atok.prototype.quiet = function (flag) {\n  this._p_quiet = (flag === true)\n  return this\n}","params":[{"type":"param","types":["boolean","undefined"],"name":"flag","description":""}],"has_params":true,"tags":[{"type":"param","types":["boolean","undefined"],"name":"flag","description":""},{"type":"return","types":["Atok"],"description":""},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"15-1353393114763","name":"trimLeft","signiture":"Atok.prototype.trimLeft()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"trimLeft","string":"Atok.prototype.trimLeft()"},"description":{"full":"<p>Remove the left matched pattern for all subsequent rules</p>","summary":"<p>Remove the left matched pattern for all subsequent rules</p>","body":""},"full_description":"<p>Remove the left matched pattern for all subsequent rules</p>","code":"Atok.prototype.trimLeft = function (flag) {\n  this._p_trimLeft = (flag === true)\n  return this\n}","params":[{"type":"param","types":["boolean","undefined"],"name":"flag","description":""}],"has_params":true,"tags":[{"type":"param","types":["boolean","undefined"],"name":"flag","description":""},{"type":"return","types":["Atok"],"description":""},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"16-1353393114763","name":"trimRight","signiture":"Atok.prototype.trimRight()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"trimRight","string":"Atok.prototype.trimRight()"},"description":{"full":"<p>Remove the right matched pattern for all subsequent rules<br />If only 1 pattern, it is ignored</p>","summary":"<p>Remove the right matched pattern for all subsequent rules<br />If only 1 pattern, it is ignored</p>","body":""},"full_description":"<p>Remove the right matched pattern for all subsequent rules If only 1 pattern, it is ignored</p>","code":"Atok.prototype.trimRight = function (flag) {\n  this._p_trimRight = (flag === true)\n  return this\n}","params":[{"type":"param","types":["boolean","undefined"],"name":"flag","description":""}],"has_params":true,"tags":[{"type":"param","types":["boolean","undefined"],"name":"flag","description":""},{"type":"return","types":["Atok"],"description":""},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"17-1353393114763","name":"trim","signiture":"Atok.prototype.trim()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"trim","string":"Atok.prototype.trim()"},"description":{"full":"<p>Remove the left and right matched patterns for all subsequent rules</p>","summary":"<p>Remove the left and right matched patterns for all subsequent rules</p>","body":""},"full_description":"<p>Remove the left and right matched patterns for all subsequent rules</p>","code":"Atok.prototype.trim = function (flag) {\n  return this.trimLeft(flag).trimRight(flag)\n}","params":[{"type":"param","types":["boolean","undefined"],"name":"flag","description":""}],"has_params":true,"tags":[{"type":"param","types":["boolean","undefined"],"name":"flag","description":""},{"type":"return","types":["Atok"],"description":""},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"18-1353393114763","name":"escape","signiture":"Atok.prototype.escape()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"escape","string":"Atok.prototype.escape()"},"description":{"full":"<p>Do not remove the left and right matched patterns for all subsequent rules<br />The default escape character is , can be changed by specifying it instead of a Boolean</p>","summary":"<p>Do not remove the left and right matched patterns for all subsequent rules<br />The default escape character is , can be changed by specifying it instead of a Boolean</p>","body":""},"full_description":"<p>Do not remove the left and right matched patterns for all subsequent rules The default escape character is , can be changed by specifying it instead of a Boolean</p>","code":"Atok.prototype.escape = function (flag) {\n  this._p_escape = flag === true\n    ? '\\\\'\n    : flag && flag.length > 0\n      ? flag.toString(this._encoding || 'utf8').charAt(0)\n      : false\n  return this\n}","params":[{"type":"param","types":["boolean","undefined"],"name":"flag","description":""}],"has_params":true,"tags":[{"type":"param","types":["boolean","undefined"],"name":"flag","description":""},{"type":"return","types":["Atok"],"description":""},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"19-1353393114763","name":"continue","signiture":"Atok.prototype.continue()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"continue","string":"Atok.prototype.continue()"},"description":{"full":"<p>Continue the rules flow if rule matches at the specified rule index</p>","summary":"<p>Continue the rules flow if rule matches at the specified rule index</p>","body":""},"full_description":"<p>Continue the rules flow if rule matches at the specified rule index</p>","code":"Atok.prototype.continue = function (jump, jumpOnFail) {\n  if (arguments.length === 0) {\n    this._p_continue = null\n    this._p_continueOnFail = null\n\n    return this\n  }\n\n  if ( jump !== null && !/(number|string|function)/.test(typeof jump) )\n    this._error( new Error('Atok#continue: Invalid jump (must be an integer/function/string): ' + jump) )\n  \n  if (arguments.length === 1)\n    jumpOnFail = null\n  else if ( jumpOnFail !== null && !/(number|string|function)/.test(typeof jumpOnFail) )\n    this._error( new Error('Atok#continue: Invalid jump (must be an integer/function/string): ' + jumpOnFail) )\n  \n  this._p_continue = jump\n  this._p_continueOnFail = jumpOnFail\n\n  return this\n}","params":[{"type":"param","types":["number","null","undefined"],"name":"number","description":"of rules to skip before continuing"},{"type":"param","types":["number","null","undefined"],"name":"when","description":"the rule fails, number of rules to skip before continuing"}],"has_params":true,"tags":[{"type":"param","types":["number","null","undefined"],"name":"number","description":"of rules to skip before continuing"},{"type":"param","types":["number","null","undefined"],"name":"when","description":"the rule fails, number of rules to skip before continuing"},{"type":"return","types":["Atok"],"description":""},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"20-1353393114763","name":"break","signiture":"Atok.prototype.break()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"break","string":"Atok.prototype.break()"},"description":{"full":"<p>Abort a current rule set. Use continue(-1) to resume at the current subrule.</p>","summary":"<p>Abort a current rule set. Use continue(-1) to resume at the current subrule.</p>","body":""},"full_description":"<p>Abort a current rule set. Use continue(-1) to resume at the current subrule.</p>","code":"Atok.prototype.break = function (flag) {\n  this._p_break = (flag === true)\n  return this\n}","params":[],"has_params":false,"tags":[{"type":"return","types":["Atok"],"description":""},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"21-1353393114763","name":"setProps","signiture":"Atok.prototype.setProps()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"setProps","string":"Atok.prototype.setProps()"},"description":{"full":"<p>Restore properties</p>","summary":"<p>Restore properties</p>","body":""},"full_description":"<p>Restore properties</p>","code":"Atok.prototype.setProps = function (props) {\n  var propNames = Object.keys(props || {})\n\n  for (var prop, i = 0, n = propNames.length; i < n; i++) {\n    prop = propNames[i]\n    if ( this.hasOwnProperty('_p_' + prop) )\n      switch (prop) {\n        // Special case: continue has 2 properties\n        case 'continue':\n          this._p_continue = props[ prop ][0]\n          this._p_continueOnFail = props[ prop ][1]\n        break\n        // Special case: next has 2 properties\n        case 'next':\n          this._p_next = props[ prop ][0]\n          this._p_nextIndex = props[ prop ][1]\n        break\n        default:\n          this[ '_p_' + prop ] = props[ prop ]\n      }\n  }\n\n  return this\n}","params":[{"type":"param","types":["Object"],"name":"properties","description":"to be loaded"}],"has_params":true,"tags":[{"type":"param","types":["Object"],"name":"properties","description":"to be loaded"},{"type":"return","types":["Atok"],"description":""},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"22-1353393114763","name":"clearProps","signiture":"Atok.prototype.clearProps()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"clearProps","string":"Atok.prototype.clearProps()"},"description":{"full":"<p>Reset properties to their default values</p>","summary":"<p>Reset properties to their default values</p>","body":""},"full_description":"<p>Reset properties to their default values</p>","code":"Atok.prototype.clearProps = function () {\n// include(\"Atok_rule_properties.js\")\n  this._p_ignore = false        // Get the token size and skip\n  this._p_quiet = false         // Get the token size and call the handler with no data\n  this._p_escape = false        // Pattern must not be escaped\n  this._p_trimLeft = true       // Remove the left pattern from the token\n  this._p_trimRight = true      // Remove the right pattern from the token\n  this._p_next = null           // Next rule to load\n  this._p_nextIndex = 0         // Index for the next rule to load\n  this._p_continue = null       // Next rule index to load\n  this._p_continueOnFail = null // Next rule index to load when rule fails\n  this._p_break = false         // Abort current rule set\n  return this\n}","params":[],"has_params":false,"tags":[{"type":"return","types":["Atok"],"description":""},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"23-1353393114763","name":"getProps","signiture":"Atok.prototype.getProps()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"getProps","string":"Atok.prototype.getProps()"},"description":{"full":"<p>Reset properties to their default values</p>","summary":"<p>Reset properties to their default values</p>","body":""},"full_description":"<p>Reset properties to their default values</p>","code":"Atok.prototype.getProps = function () {\n  // Empty object with no prototype\n  var props = Object.create(null)\n  var propNames = arguments.length > 0\n        ? sliceArguments(arguments, 0)\n        : this._defaultProps\n\n  for (var prop, i = 0, num = propNames.length; i < num; i++) {\n    prop = propNames[i]\n    if ( this.hasOwnProperty('_p_' + prop) )\n      switch (prop) {\n        // Special case: continue has 2 properties\n        case 'continue':\n          props[ prop ] = [ this._p_continue, this._p_continueOnFail ]\n        break\n        // Special case: next has 2 properties\n        case 'next':\n          props[ prop ] = [ this._p_next, this._p_nextIndex ]\n        break\n        default:\n          props[ prop ] = this[ '_p_' + prop ]\n      }\n  }\n\n  return props\n}\n// include(\"methods_ruleset.js\")","params":[],"has_params":false,"tags":[{"type":"return","types":["Object"],"description":""},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"24-1353393114763","name":"addRuleFirst","signiture":"Atok.prototype.addRuleFirst()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"addRuleFirst","string":"Atok.prototype.addRuleFirst()"},"description":{"full":"<p>Add a rule as the first one</p>","summary":"<p>Add a rule as the first one</p>","body":""},"full_description":"<p>Add a rule as the first one</p>","code":"Atok.prototype.addRuleFirst = function (rule,","params":[{"type":"param","types":["string","number","function()"],"name":"name","description":"of the rule to be added first"},{"type":"param","types":["...string","number","function()"],"name":"rule","description":"item"},{"type":"param","types":["string","number","function()"],"name":"rule","description":"type"}],"has_params":true,"tags":[{"type":"param","types":["string","number","function()"],"name":"name","description":"of the rule to be added first"},{"type":"param","types":["...string","number","function()"],"name":"rule","description":"item"},{"type":"param","types":["string","number","function()"],"name":"rule","description":"type"},{"type":"return","types":["Atok"],"description":""},{"type":"api","visibility":"public"},{"type":"see","local":"Atok#addRule","visibility":"Atok#addRule"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"26-1353393114763","name":"addRuleBefore","signiture":"Atok.prototype.addRuleBefore()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"addRuleBefore","string":"Atok.prototype.addRuleBefore()"},"description":{"full":"<p>Add a rule before an existing one</p>","summary":"<p>Add a rule before an existing one</p>","body":""},"full_description":"<p>Add a rule before an existing one</p>","code":"Atok.prototype.addRuleBefore = function (existingRule, rule,","params":[{"type":"param","types":["string","number","function()"],"name":"name","description":"of the rule to add before"},{"type":"param","types":["...string","number","function()"],"name":"rule","description":"item"},{"type":"param","types":["string","number","function()"],"name":"rule","description":"type"}],"has_params":true,"tags":[{"type":"param","types":["string","number","function()"],"name":"name","description":"of the rule to add before"},{"type":"param","types":["...string","number","function()"],"name":"rule","description":"item"},{"type":"param","types":["string","number","function()"],"name":"rule","description":"type"},{"type":"return","types":["Atok"],"description":""},{"type":"api","visibility":"public"},{"type":"see","local":"Atok#addRule","visibility":"Atok#addRule"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"28-1353393114763","name":"addRuleAfter","signiture":"Atok.prototype.addRuleAfter()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"addRuleAfter","string":"Atok.prototype.addRuleAfter()"},"description":{"full":"<p>Add a rule after an existing one</p>","summary":"<p>Add a rule after an existing one</p>","body":""},"full_description":"<p>Add a rule after an existing one</p>","code":"Atok.prototype.addRuleAfter = function (existingRule, rule,","params":[{"type":"param","types":["string","number","function()"],"name":"name","description":"of the rule to add after"},{"type":"param","types":["...string","number","function()"],"name":"rule","description":"item"},{"type":"param","types":["string","number","function()"],"name":"rule","description":"type"}],"has_params":true,"tags":[{"type":"param","types":["string","number","function()"],"name":"name","description":"of the rule to add after"},{"type":"param","types":["...string","number","function()"],"name":"rule","description":"item"},{"type":"param","types":["string","number","function()"],"name":"rule","description":"type"},{"type":"return","types":["Atok"],"description":""},{"type":"api","visibility":"public"},{"type":"see","local":"Atok#addRule","visibility":"Atok#addRule"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"30-1353393114763","name":"addRule","signiture":"Atok.prototype.addRule()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"addRule","string":"Atok.prototype.addRule()"},"description":{"full":"<p>Add a rule</p>","summary":"<p>Add a rule</p>","body":""},"full_description":"<p>Add a rule</p>","code":"Atok.prototype.addRule = function (","params":[{"type":"param","types":["...string","number","function()"],"name":"match","description":"at current buffer position (String: expect string, Integer: expect n characters, Array: expect one of the items). If not needed, use ''"},{"type":"param","types":["false","string","number","function()"],"name":"rule","description":"name/id (if no default handler set, emit a data event) or handler (executed when all matches are valid). If false, the rule is ignored."}],"has_params":true,"tags":[{"type":"param","types":["...string","number","function()"],"name":"match","description":"at current buffer position (String: expect string, Integer: expect n characters, Array: expect one of the items). If not needed, use ''"},{"type":"param","types":["false","string","number","function()"],"name":"rule","description":"name/id (if no default handler set, emit a data event) or handler (executed when all matches are valid). If false, the rule is ignored."},{"type":"return","types":["Atok"],"description":""},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"33-1353393114763","name":"removeRule","signiture":"Atok.prototype.removeRule()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"removeRule","string":"Atok.prototype.removeRule()"},"description":{"full":"<p>Remove a rule (first instance only)</p>","summary":"<p>Remove a rule (first instance only)</p>","body":""},"full_description":"<p>Remove a rule (first instance only)</p>","code":"Atok.prototype.removeRule = function (","params":[{"type":"param","types":["string"],"name":"name","description":"of the rule to be removed"}],"has_params":true,"tags":[{"type":"param","types":["string"],"name":"name","description":"of the rule to be removed"},{"type":"return","types":["Atok"],"description":""},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"35-1353393114763","name":"clearRule","signiture":"Atok.prototype.clearRule()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"clearRule","string":"Atok.prototype.clearRule()"},"description":{"full":"<p>Remove all rules</p>","summary":"<p>Remove all rules</p>","body":""},"full_description":"<p>Remove all rules</p>","code":"Atok.prototype.clearRule = function () {\n  this.clearProps()\n  this._firstRule = null\n  this._rules = []\n  this._defaultHandler = null\n  this._rulesToResolve = false\n\n  return this\n}","params":[],"has_params":false,"tags":[{"type":"return","types":["Atok"],"description":""},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"36-1353393114763","name":"saveRuleSet","signiture":"Atok.prototype.saveRuleSet()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"saveRuleSet","string":"Atok.prototype.saveRuleSet()"},"description":{"full":"<p>Save all rules and clear them</p>","summary":"<p>Save all rules and clear them</p>","body":""},"full_description":"<p>Save all rules and clear them</p>","code":"Atok.prototype.saveRuleSet = function (name) {\n  if (arguments.length === 0 || name === null)\n    return this._error( new Error('Atok#saveRuleSet: invalid rule name supplied') )\n\n  this._savedRules[name] = {\n    rules: this._rules\n      .map(function (rule) {    // Clone and assign the current rule set name\n        return rule.clone(name)\n      })\n  }\n\n  // Resolve and check continues\n  this._resolveRules(name)\n\n  return this\n}","params":[{"type":"param","types":["string"],"name":"name","description":"of the rule set"}],"has_params":true,"tags":[{"type":"param","types":["string"],"name":"name","description":"of the rule set"},{"type":"return","types":["Atok"],"description":""},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"37-1353393114763","name":"loadRuleSet","signiture":"Atok.prototype.loadRuleSet()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"loadRuleSet","string":"Atok.prototype.loadRuleSet()"},"description":{"full":"<p>Load a rule set</p>","summary":"<p>Load a rule set</p>","body":""},"full_description":"<p>Load a rule set</p>","code":"Atok.prototype.loadRuleSet = function (name, index) {\n  var ruleSet = this._savedRules[name]\n  if (!ruleSet)\n    return this._error( new Error('Atok#loadRuleSet: Rule set ' + name + ' not found') )\n\n  index = typeof index === 'number' ? index : 0\n\n  this._rules = ruleSet.rules\n  // Set the rule index\n  this._firstRule = this._rules[index]\n  this._resetRule = true\n\n  return this\n}","params":[{"type":"param","types":["string"],"name":"name","description":"of the rule set"},{"type":"param","types":["number"],"name":"index","description":"to start at"}],"has_params":true,"tags":[{"type":"param","types":["string"],"name":"name","description":"of the rule set"},{"type":"param","types":["number"],"name":"index","description":"to start at"},{"type":"return","types":["Atok"],"description":""},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"38-1353393114763","name":"removeRuleSet","signiture":"Atok.prototype.removeRuleSet()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"removeRuleSet","string":"Atok.prototype.removeRuleSet()"},"description":{"full":"<p>Delete a rule set</p>","summary":"<p>Delete a rule set</p>","body":""},"full_description":"<p>Delete a rule set</p>","code":"Atok.prototype.removeRuleSet = function (name) {\n  delete this._savedRules[name]\n\n  return this\n}","params":[{"type":"param","types":["string"],"name":"name","description":"of the rule set"}],"has_params":true,"tags":[{"type":"param","types":["string"],"name":"name","description":"of the rule set"},{"type":"return","types":["Atok"],"description":""},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"39-1353393114763","name":"groupRule","signiture":"Atok.prototype.groupRule()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"groupRule","string":"Atok.prototype.groupRule()"},"description":{"full":"<p>Bind rules to the same index</p>","summary":"<p>Bind rules to the same index</p>","body":""},"full_description":"<p>Bind rules to the same index</p>","code":"Atok.prototype.groupRule = function (flag) {\n  var rules = this._rules\n\n  if (flag) {\n    this._group++\n    this._groupStartPrev.push(this._groupStart)\n    this._groupStart = rules.length\n\n    return this\n  }\n\n  // Ignore invalid groupRule()\n  if (this._group < 0) return this\n  \n  // 1 or 0 rule within the group, ignored it\n  if (rules.length - this._groupStart < 2) {\n    for (var i = this._groupStart, n = rules.length; i < n; i++) {\n      rules[i].group = -1\n      rules[i].groupStart = 0\n      rules[i].groupEnd = 0\n    }\n  } else {\n    // Set the last index of the group to all rules belonging to the current group\n    for (var i = this._groupStart, n = rules.length; i < n; i++)\n      if (rules[i].group === this._group)\n        rules[i].groupEnd = n - 1\n  }\n\n  this._group--\n  this._groupStart = this._groupStartPrev.pop() || 0\n  this._groupEnd = 0\n\n  return this\n}","params":[{"type":"param","types":["Boolean"],"name":"toggle","description":"grouping on/off"}],"has_params":true,"tags":[{"type":"param","types":["Boolean"],"name":"toggle","description":"grouping on/off"},{"type":"return","types":["Atok"],"description":""},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"40-1353393114763","name":"write","signiture":"Atok.prototype.write()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"write","string":"Atok.prototype.write()"},"description":{"full":"<p>Applies the current rules to the incoming data.<br />When false is returned (the tokenizer is paused), the data is buffered but<br />no processing occurs until the tokenizer is resumed.</p>","summary":"<p>Applies the current rules to the incoming data.<br />When false is returned (the tokenizer is paused), the data is buffered but<br />no processing occurs until the tokenizer is resumed.</p>","body":""},"full_description":"<p>Applies the current rules to the incoming data. When false is returned (the tokenizer is paused), the data is buffered but no processing occurs until the tokenizer is resumed.</p>","code":"Atok.prototype.write = function (data) {\n  if (this.ended) {\n    this._error( new Error('Atok#write: write after end') )\n    return false\n  }\n\n  if (!data || data.length === 0) return true\n\n  // Setting the encoding by default when receiving a string\n  if ( typeof data === 'string' && !this._encoding ) this.setEncoding('utf-8')\n\n  // Buffer the incoming data...\n  if (this.length > 0) {\n    // Process strings and Buffers separately\n    if ( this._encoding ) {\n      this.buffer += this._stringDecoder.write( data.toString() )\n    } else {\n      this.buffer = this.buffer.concat(data)\n      // this.buffer = Buffer.concat( [ this.buffer, data ], this.length )\n    }\n  } else {\n    this.buffer = this._encoding ? data.toString() : data\n  }\n  this.length = this.buffer.length\n\n  // Check rules resolution (pause __can__ be called before write)\n  if (this._rulesToResolve) this._resolveRules() // Does linking too\n  // No resolution but linking may be required\n  else if (this._rulesToLink) this._linkRules()\n\n  // ... hold on until tokenization completed on the current data set\n  // or consume the data\n  if (this.paused) {\n    this.needDrain = true\n    return false\n  }\n\n  return this._tokenize()\n}","params":[{"type":"param","types":["string","Buffer"],"name":"data","description":"to be processed"}],"has_params":true,"tags":[{"type":"param","types":["string","Buffer"],"name":"data","description":"to be processed"},{"type":"return","types":["boolean"],"description":"whether `Atok#write()` can be called again"},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"41-1353393114763","name":"end","signiture":"Atok.prototype.end()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"end","string":"Atok.prototype.end()"},"description":{"full":"<p>Ends the stream and emit the <code>end</code> event. Any remaining data is passed to <br />the listeners.</p>","summary":"<p>Ends the stream and emit the <code>end</code> event. Any remaining data is passed to <br />the listeners.</p>","body":""},"full_description":"<p>Ends the stream and emit the <code>end</code> event. Any remaining data is passed to  the listeners.</p>","code":"Atok.prototype.end = function (data) {\n  this.ending = true\n  this.write(data)\n  this.ended = true\n  this.ending = false\n\n  this.readable = false\n  this.writable = false\n\n  this._end()\n  return this\n}","params":[{"type":"param","types":["string","Buffer"],"name":"data","description":"to be processed"}],"has_params":true,"tags":[{"type":"param","types":["string","Buffer"],"name":"data","description":"to be processed"},{"type":"return","types":["Atok"],"description":""},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"42-1353393114763","name":"pause","signiture":"Atok.prototype.pause()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"pause","string":"Atok.prototype.pause()"},"description":{"full":"<p>Pauses the stream - data is buffered until the <br /> stream is resumed with <code>Atok#resume()</code></p>","summary":"<p>Pauses the stream - data is buffered until the <br /> stream is resumed with <code>Atok#resume()</code></p>","body":""},"full_description":"<p>Pauses the stream - data is buffered until the   stream is resumed with <code>Atok#resume()</code></p>","code":"Atok.prototype.pause = function () {\n  this.paused = true\n  return this\n}","params":[],"has_params":false,"tags":[{"type":"return","types":["Atok"],"description":""},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"43-1353393114763","name":"resume","signiture":"Atok.prototype.resume()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"resume","string":"Atok.prototype.resume()"},"description":{"full":"<p>Resumes the stream - buffered data is immediately processed</p>","summary":"<p>Resumes the stream - buffered data is immediately processed</p>","body":""},"full_description":"<p>Resumes the stream - buffered data is immediately processed</p>","code":"Atok.prototype.resume = function () {\n  this.paused = false\n  return this._tokenize()\n}","params":[],"has_params":false,"tags":[{"type":"return","types":["boolean"],"description":"same as `Atok#write()`"},{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"44-1353393114763","name":"destroy","signiture":"Atok.prototype.destroy()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"destroy","string":"Atok.prototype.destroy()"},"description":{"full":"<p>Placeholder for <code>Atok#destroy()</code></p>","summary":"<p>Placeholder for <code>Atok#destroy()</code></p>","body":""},"full_description":"<p>Placeholder for <code>Atok#destroy()</code></p>","code":"Atok.prototype.destroy = function () {\n  this.readable = false\n  this.writable = false\n}","params":[],"has_params":false,"tags":[{"type":"api","visibility":"public"}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"46-1353393114763","name":"_end","signiture":"Atok.prototype._end()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"_end","string":"Atok.prototype._end()"},"description":{"full":"<p>End a stream by emitting the <code>end</code> event with remaining data</p>","summary":"<p>End a stream by emitting the <code>end</code> event with remaining data</p>","body":""},"full_description":"<p>End a stream by emitting the <code>end</code> event with remaining data</p>","code":"Atok.prototype._end = function () {\n  this.emit_end( this.buffer, -1, this.currentRule )\n  this.clear()\n}","params":[],"has_params":false,"tags":[{"type":"private","string":""}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"47-1353393114763","name":"_done","signiture":"Atok.prototype._done()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"_done","string":"Atok.prototype._done()"},"description":{"full":"<p>End of <code>Atok#write()</code>: emit the <code>drain</code> event if required</p>","summary":"<p>End of <code>Atok#write()</code>: emit the <code>drain</code> event if required</p>","body":""},"full_description":"<p>End of <code>Atok#write()</code>: emit the <code>drain</code> event if required</p>","code":"Atok.prototype._done = function () {\n  if (this.needDrain) {\n    this.needDrain = false\n    this.emit_drain()\n  }\n\n  if (this.ended) {\n    this._end()\n    return false\n  }\n\n  return true\n}","params":[],"has_params":false,"tags":[{"type":"private","string":""}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true},{"id":"48-1353393114763","name":"_tokenize","signiture":"Atok.prototype._tokenize()","type":"method","ctx":{"type":"method","constructor":"Atok","name":"_tokenize","string":"Atok.prototype._tokenize()"},"description":{"full":"<p>The core of Atok. Loops through the rules and check them against the data,<br />calling handler or emitting the <code>data</code> event and branching appropriately.</p>","summary":"<p>The core of Atok. Loops through the rules and check them against the data,<br />calling handler or emitting the <code>data</code> event and branching appropriately.</p>","body":""},"full_description":"<p>The core of Atok. Loops through the rules and check them against the data, calling handler or emitting the <code>data</code> event and branching appropriately.</p>","code":"Atok.prototype._tokenize = function () {\n  // NB. Rules and buffer can be reset by the token handler\n  var p, props, matched\n  var token\n\n  p = this._firstRule\n  this._resetRule = false\n\n  while ( p && this.offset < this.length ) {\n    props = p.props\n\n    // Return the size of the matched data (0 is valid!)\n    matched = p.test(this.buffer, this.offset)\n\n    if ( matched < 0 ) {\n      // End of the rule set, end the loop\n      if (!p.nextFail) break\n\n      // Next rule exists, carry on\n      p = p.nextFail\n      continue\n    }\n\n    // Is the token to be processed?\n    if ( props.ignore ) {\n      p = p.next\n    } else {\n      // Emit the data by default, unless the handler is set\n      token = props.quiet\n        ? matched - (p.single ? 0 : p.last.length) - p.first.length\n        : this.buffer.slice(\n            this.offset + p.first.length\n          , this.offset + matched - (p.single ? 0 : p.last.length)\n          )\n\n      if (p.handler) p.handler(token, p.last.idx, p.type)\n      else this.emit_data(token, p.last.idx, p.type)\n\n      // Handler has changed rules, resolve and relink\n      if (this._rulesToResolve) this._resolveRules()\n\n      // RuleSet may have be changed by the handler\n      if (this._resetRule) {\n        this._resetRule = false\n        p = this._firstRule\n      } else {\n        p = p.next\n      }\n    }\n\n    this.offset += matched\n\n    // NB. `break()` prevails over `pause()`\n    if (props.break) break\n\n    // Hold on if the stream was paused\n    if (this.paused) {\n      this._firstRule = p\n      this.needDrain = true\n      return false\n    }\n  }\n\n  // Keep track of the rule we are at\n  if (p) this._firstRule = p\n\n  // Truncate the buffer if possible: min(offset, markedOffset)\n  if (this.markedOffset < 0) {\n    // No marked offset or beyond the current offset\n    if (this.offset === this.length) {\n      this.offset = 0\n      this.buffer = null\n      this.length = 0\n      this.emit_empty(this.ending)\n\n    } else if (this.offset < this.length) {\n      this.buffer = this.buffer.slice(this.offset)\n      this.length = this.buffer.length\n      this.offset = 0\n\n    } else {\n      // Can only occurs if offset was manually incremented\n      this.offset = this.offset - this.length\n      this.buffer = null\n      this.length = 0\n    }\n\n  } else {\n    var maxOffset = 'markedOffset'\n    var minOffset = 'offset'\n    var _\n\n    if (this.markedOffset < this.offset) {\n      _ = maxOffset\n      maxOffset = minOffset\n      minOffset = _\n    }\n\n    if (this[minOffset] === this.length) {\n      this[maxOffset] -= this[minOffset]\n      this[minOffset] = 0\n      this.buffer = null\n      this.length = 0\n      this.emit_empty(this.ending)\n\n    } else if (this[minOffset] < this.length) {\n      this[maxOffset] -= this[minOffset]\n      this.buffer = this.buffer.slice(this[minOffset])\n      this.length = this.buffer.length\n      this[minOffset] = 0\n\n    } else {\n      // Can only occurs if offset was manually incremented\n      this[maxOffset] -= this.length\n      this[minOffset] -= this.length\n      this.buffer = null\n      this.length = 0\n    }\n  }\n\n  return this._done()\n}","params":[],"has_params":false,"tags":[{"type":"return","types":["boolean"],"description":""},{"type":"private","string":""}],"module":false,"parent":"Atok","related":{"href":""},"has_related":true}]}]
  </script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js" type="text/javascript" charset="utf-8"></script>

  <script type="text/javascript" charset="utf-8">
    // lunr.js version: 0.0.4
    // (c) 2011 Oliver Nightingale
    //
    //  Released under MIT license.
    //
    var Lunr=function(c,f){var b=new Lunr.Index(c);f.call(b,b);return b};
    Lunr.utils={uniq:function(c){if(!c)return[];return c.reduce(function(c,b){c.indexOf(b)===-1&&c.push(b);return c},[])},intersect:function(c){var f=[].slice.call(arguments,1);return this.uniq(c).filter(function(b){return f.every(function(a){return a.indexOf(b)>=0})})},detect:function(c,f,b){for(var a=c.length,g=null,d=0;d<a;d++)if(f.call(b,c[d],d,c)){g=c[d];break}return g},copy:function(c){return Object.keys(c).reduce(function(f,b){f[b]=c[b];return f},{})}};
    Lunr.Trie=function(){var c=function(){this.children={};this.values=[]};c.prototype={childForKey:function(b){var a=this.children[b];a||(a=new c,this.children[b]=a);return a}};var f=function(){this.root=new c};f.prototype={get:function(b){var a=this;return this.keys(b).reduce(function(c,d){a.getNode(d).values.forEach(function(a){a=Lunr.utils.copy(a);if(b===d)a.exact=!0;c.push(a)});return c},[])},getNode:function(b){var a=function(b,d){if(!d.length)return b;return a(b.childForKey(d.charAt(0)),d.slice(1))};
    return a(this.root,b)},keys:function(b){var a=[];b=b||"";var c=function(b,e){b.values.length&&a.push(e);Object.keys(b.children).forEach(function(a){c(b.children[a],e+a)})};c(this.getNode(b),b);return a},set:function(b,a){var c=function(b,e){if(!e.length)return b.values.push(a);c(b.childForKey(e.charAt(0)),e.slice(1))};return c(this.root,b)}};return f}();Lunr.Index=function(c){this.name=c;this.refName="id";this.fields={};this.trie=new Lunr.Trie};
    Lunr.Index.prototype={add:function(c){(new Lunr.Document(c,this.refName,this.fields)).words().forEach(function(c){this.trie.set(c.id,c.docs[0])},this)},field:function(c,f){this.fields[c]=f||{multiplier:1}},ref:function(c){this.refName=c},search:function(c){if(!c)return[];c=c.split(" ").map(function(c){c=new Lunr.Word(c);if(!c.isStopWord())return c.toString()}).filter(function(c){return c}).map(function(c){return this.trie.get(c).sort(function(b,a){if(b.exact&&a.exact===void 0)return-1;if(a.exact&&
    b.exact===void 0)return 1;if(b.score<a.score)return 1;if(b.score>a.score)return-1;return 0}).map(function(b){return b.documentId})},this);return Lunr.utils.intersect.apply(Lunr.utils,c)}};Lunr.Document=function(c,f,b){this.original=c;this.fields=b;this.ref=c[f]};
    Lunr.Document.prototype={asJSON:function(){return{id:this.ref,words:this.words().map(function(c){return c.id}),original:this.original}},words:function(){var c=this,f={};Object.keys(this.fields).forEach(function(b){c.original[b].split(/\b/g).filter(function(a){return!!a.match(/\w/)}).map(function(a){a=new Lunr.Word(a);if(!a.isStopWord())return a.toString()}).filter(function(a){return a}).forEach(function(a){f[a]||(f[a]={score:0,ref:c.ref});f[a].score+=c.fields[b].multiplier})});return Object.keys(f).map(function(b){return{id:b,
    docs:[{score:f[b].score,documentId:c.ref}]}})}};Lunr.Word=function(c){this.raw=c;this.out=this.raw.replace(/^\W+/,"").replace(/\W+$/,"").toLowerCase()};Lunr.Word.stopWords=["the","of","to","and","a","in","is","it","you","that","this"];
    Lunr.Word.prototype={isStopWord:function(){return Lunr.Word.stopWords.indexOf(this.raw.toLowerCase())!==-1},toString:function(){if(!this.isStopWord())return this.stem(),this.out},stem:function(){var c={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},f={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",
    ful:"",ness:""};return function(){var b,a,g,d=g=this.out;if(g.length<3)return g;var e,h;g=g.substr(0,1);g=="y"&&(d=g.toUpperCase()+d.substr(1));e=/^(.+?)(ss|i)es$/;a=/^(.+?)([^s])s$/;e.test(d)?d=d.replace(e,"$1$2"):a.test(d)&&(d=d.replace(a,"$1$2"));e=/^(.+?)eed$/;a=/^(.+?)(ed|ing)$/;e.test(d)?(a=e.exec(d),e=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,e.test(a[1])&&(e=/.$/,d=d.replace(e,""))):a.test(d)&&(a=a.exec(d),b=a[1],a=/^([^aeiou][^aeiouy]*)?[aeiouy]/,a.test(b)&&(d=b,a=/(at|bl|iz)$/,
    h=/([^aeiouylsz])\1$/,b=/^[^aeiou][^aeiouy]*[aeiouy][^aeiouwxy]$/,a.test(d)?d+="e":h.test(d)?(e=/.$/,d=d.replace(e,"")):b.test(d)&&(d+="e")));e=/^(.+?)y$/;e.test(d)&&(a=e.exec(d),b=a[1],e=/^([^aeiou][^aeiouy]*)?[aeiouy]/,e.test(b)&&(d=b+"i"));e=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/;e.test(d)&&(a=e.exec(d),b=a[1],a=a[2],e=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,e.test(b)&&(d=b+c[a]));
    e=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/;e.test(d)&&(a=e.exec(d),b=a[1],a=a[2],e=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,e.test(b)&&(d=b+f[a]));e=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/;a=/^(.+?)(s|t)(ion)$/;e.test(d)?(a=e.exec(d),b=a[1],e=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,e.test(b)&&(d=b)):a.test(d)&&(a=a.exec(d),b=a[1]+a[2],a=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,
    a.test(b)&&(d=b));e=/^(.+?)e$/;if(e.test(d)&&(a=e.exec(d),b=a[1],e=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,a=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*([aeiouy][aeiou]*)?$/,h=/^[^aeiou][^aeiouy]*[aeiouy][^aeiouwxy]$/,e.test(b)||a.test(b)&&!h.test(b)))d=b;e=/ll$/;a=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*[aeiouy][aeiou]*[^aeiou][^aeiouy]*/;e.test(d)&&a.test(d)&&(e=/.$/,d=d.replace(e,""));g=="y"&&(d=g.toLowerCase()+
    d.substr(1));this.out=d}}()};
  </script>

  <script type="text/javascript" charset="utf-8">
    var idx = Lunr('methods', function () {
      this.ref('id')
      this.field('name', { multiplier: 10 })
      this.field('parent', { multiplier: 5 })
      this.field('full_description')
    })

    var methods = raw.reduce(function (memo, module) {
      return memo.concat(module.methods)
    }, [])

    methods.forEach(function (method) {
      idx.add(method)
    })

    $(document).ready(function () {

      var search = function (term) {
        return idx.search(term).map(function (id) {
          return methods.filter(function (method) {
            return method.id === id
          })[0]
        })
      }

      var searchResults = $('#search-results')

      $('#search-input').keyup(function () {
        var query = $(this).val(),
            results = search(query)

        if (!results.length) {
          searchResults.empty()
          return
        };

        var resultsList = results.reduce(function (ul, result) {
          var li = $('<li>').append($('<a>', {
            href: '#' + result.name,
            text: result.name
          }))

          ul.append(li)

          return ul
        }, $('<ul>'))

        searchResults.html(resultsList)
      })
    })
  </script>

  <style type="text/css" media="screen">
    body {
  font-family: 'Helvetica Neue';
  color: #333;
}

a {
  color: #0f4bf0;
}

header h1 {
  border-top: 4px solid #333;
  font-size: 2.6em;
}

header .version {
  font-size: 0.6em;
}

.main > header {
  margin-bottom: 40px;
}

article {
  margin-bottom: 10px;
  padding-bottom: 30px;
}

article header h2 {
  border-top: 3px solid #333;
  font-size: 2em;
  padding-top: 5px;
}

article > section {
  margin-bottom: 30px;
}

article section h3 {
  font-size: 1em;
}

article section header h3 {
  padding-top: 2px;
  font-size: 1.2em;
  margin-bottom: 5px;
  border-top: 2px solid #333;
}

article section header h4 {
  font-size: 0.9em;
  font-family: courier;
  margin: 2px 0 5px 0;
}

@-webkit-keyframes highlight {
  from {
    background-color: #Ffff66;
  }

  to {
    background-color: white;
  }
}

section.method:target {
  -webkit-animation-duration: 1s;
  -webkit-animation-name: highlight;
}

section header .type, section header .related {
  margin-top: 0px;
  font-size: 0.8em;
}

section.params h4, section.source h4 {
  margin-top: 5px;
  margin-bottom: 2px;
  font-size: 0.9em;
}

section.params ul {
  margin-top: 2px;
}

a.show-source {
  font-size: 0.8em;
}

.wrap {
  width: 960px;
  margin: 0 auto;
}

.main {
  width: 760px;
  float: left;
}

.search {
  margin-top: 10px;
  float: right;
}

#search-input {
  width: 200px;
}

#search-results {
  position: relative;
}

#search-results ul {
  width: 200px;
  position: absolute;
  top: 0px;
  left: 0px;
  background-color: white;
  border: 1px solid #ccc;
  list-style: none;
  padding: 0;
  margin-top: 0;
  font-size: 0.9em;
}

#search-results li {
  padding: 5px;
}

#search-results li:hover {
  background-color: #eee;
  cursor: pointer;
}

#search-results li a {
  text-decoration: none;
  width: 200px;
  display: block;
}

p {
  line-height: 1.4em;
}

nav {
  padding-top: 15px;
  float: left;
  width: 165px;
  margin-right: 30px;
  text-align: right;
  font-size: 0.8em;
}

nav ul {
  list-style: none;
  margin: 0;
  padding: 0;
}

nav ul h3 {
  margin-bottom: 5px;
  border-top: 2px solid #CCC;
  padding-top: 2px;
}

nav ul ul li {
  padding: 2px 0;
}

pre {
  background-color: rgba(0,0,0,0.1);
  padding: 8px;
}

code .keyword, code .special {
  font-weight: bold;
  color: black;
}

code .string, code .regexp {
  color: green
}

code .class { 
  color: blue
}

code .number {
  color: red
}

code .comment {
  color: grey;
  font-style: italic;
}
  </style>
</head>
<body>
  <div class='wrap'>


    <nav>
      <ul>
        
          <li>
            <a href='#Atok'>
              <h3>Atok</h3>
            </a>

            <ul>
              
                <li><a href='#clear'>clear</a></li>
              
                <li><a href='#slice'>slice</a></li>
              
                <li><a href='#flush'>flush</a></li>
              
                <li><a href='#setEncoding'>setEncoding</a></li>
              
                <li><a href='#debug'>debug</a></li>
              
                <li><a href='#currentRule'>currentRule</a></li>
              
                <li><a href='#setDefaultHandler'>setDefaultHandler</a></li>
              
                <li><a href='#next'>next</a></li>
              
                <li><a href='#ignore'>ignore</a></li>
              
                <li><a href='#quiet'>quiet</a></li>
              
                <li><a href='#trimLeft'>trimLeft</a></li>
              
                <li><a href='#trimRight'>trimRight</a></li>
              
                <li><a href='#trim'>trim</a></li>
              
                <li><a href='#escape'>escape</a></li>
              
                <li><a href='#continue'>continue</a></li>
              
                <li><a href='#break'>break</a></li>
              
                <li><a href='#setProps'>setProps</a></li>
              
                <li><a href='#clearProps'>clearProps</a></li>
              
                <li><a href='#getProps'>getProps</a></li>
              
                <li><a href='#addRuleFirst'>addRuleFirst</a></li>
              
                <li><a href='#addRuleBefore'>addRuleBefore</a></li>
              
                <li><a href='#addRuleAfter'>addRuleAfter</a></li>
              
                <li><a href='#addRule'>addRule</a></li>
              
                <li><a href='#removeRule'>removeRule</a></li>
              
                <li><a href='#clearRule'>clearRule</a></li>
              
                <li><a href='#saveRuleSet'>saveRuleSet</a></li>
              
                <li><a href='#loadRuleSet'>loadRuleSet</a></li>
              
                <li><a href='#removeRuleSet'>removeRuleSet</a></li>
              
                <li><a href='#groupRule'>groupRule</a></li>
              
                <li><a href='#write'>write</a></li>
              
                <li><a href='#end'>end</a></li>
              
                <li><a href='#pause'>pause</a></li>
              
                <li><a href='#resume'>resume</a></li>
              
                <li><a href='#destroy'>destroy</a></li>
              
                <li><a href='#_end'>_end</a></li>
              
                <li><a href='#_done'>_done</a></li>
              
                <li><a href='#_tokenize'>_tokenize</a></li>
              
            </ul>
          </li>
        
      </ul>
    </nav>

    <div class='main'>
      <header>
        <div class='search'>
          <input type="search" id="search-input" placeholder="Search"></input>
          <div id="search-results"></div>
        </div>
        <h1>atok <span class='version'>0.4.2</span></h1>
      </header>

      
        <article id='Atok'>
          <header>
            <h2>Atok</h2>
          </header>

          <section>
            <p>An atok stream</p>
          </section>

          
            <section class='method' id='clear'>
              <header>
                <h3>clear</h3>
                <h4>Atok.prototype.clear()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>clear</a></p>
                
              </header>

              <section class='params'>
                
                  <h4>Params</h4>
                
                <ul>
                  
                    <li>keep - rules set (default=false)</li>
                  
                </ul>
              </section>

              

              <section>
                <p>Reset the tokenizer by clearing its buffer and rules</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.clear = function (keepRules) {
// include(&quot;Atok_properties.js&quot;)
  // Public properties
  this.buffer = null
  this.length = 0
  this.offset = 0
  this.markedOffset = -1    // Flag indicating whether the buffer should be kept when write() ends

  // Private properties
  this._firstRule = null        // Initial rule to be triggered
  this._resetRule = false       // Rule set was changed
  this._stringDecoder = this._encoding ? new StringDecoder(this._encoding) : null
  this._rulesToResolve = false  // Rules need to be resolved (continue() prop)
  this._rulesToLink = false     // Rules need to be relinked (after a rule set change)
  this._group = -1
  this._groupStart = 0
  this._groupEnd = 0
  this._groupStartPrev = []


  if (!keepRules) {

    this._rules = []              // Rules to be checked against
    this._defaultHandler = null   // Matched token default handler
    this._savedRules = {}         // Saved rules

  }

  this.clearProps()

  return this
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='slice'>
              <header>
                <h3>slice</h3>
                <h4>Atok.prototype.slice()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>slice</a></p>
                
              </header>

              <section class='params'>
                
                  <h4>Params</h4>
                
                <ul>
                  
                    <li>starting - index</li>
                  
                    <li>ending - index</li>
                  
                </ul>
              </section>

              

              <section>
                <p>Extract data from the buffer (Atok#slice)</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.slice = function (start, end) {
  return this.buffer.slice(start, end)
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='flush'>
              <header>
                <h3>flush</h3>
                <h4>Atok.prototype.flush()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>flush</a></p>
                
              </header>

              <section class='params'>
                
                <ul>
                  
                </ul>
              </section>

              

              <section>
                <p>Terminate the current tokenizing and return the current buffer</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.flush = function () {
  var data = this.slice()
  
  this.clear(true) // Keep rules!

  return data
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='setEncoding'>
              <header>
                <h3>setEncoding</h3>
                <h4>Atok.prototype.setEncoding()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>setEncoding</a></p>
                
              </header>

              <section class='params'>
                
                  <h4>Params</h4>
                
                <ul>
                  
                    <li>encoding - to be used</li>
                  
                </ul>
              </section>

              

              <section>
                <p>Set the string encoding</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.setEncoding = function (enc) {
  switch ( String(enc) ) {
    case 'null':
    case 'undefined':
      this._encoding = null
    break
    case 'UTF-8':
    case 'utf-8':
    case 'utf8':
    default:
      this._encoding = 'UTF-8'
  }
  this._stringDecoder = this._encoding
    ? new StringDecoder(this._encoding)
    : null

  return this
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='debug'>
              <header>
                <h3>debug</h3>
                <h4>Atok.prototype.debug()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>debug</a></p>
                
              </header>

              <section class='params'>
                
                  <h4>Params</h4>
                
                <ul>
                  
                    <li>toggle - debug mode on and off</li>
                  
                </ul>
              </section>

              

              <section>
                <p>Turn debug mode on or off. Emits the [debug] event. The #loadRuleSet method is also put in debug mode. All handlers log their arguments.</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.debug = function (flag) {
  var _debug = !!flag

  // Nothing to do if already in same mode
  if (_debug === this.debugMode) return this
  this.debugMode = _debug

  // Apply debug mode to all defined rules...
  var self = this
  this._rulesForEach(function (rule) {
    rule.setDebug(_debug, self)
  })

  // Apply debug mode to some methods
  ;[ 'loadRuleSet' ].forEach(function (method) {
    if (_debug) {
      var prevMethod = self[method]

      self[method] = function () {
        self.emit_debug( 'Atok#', method, arguments )
        return prevMethod.apply(self, arguments)
      }
    } else {
      // Restore the prototype method
      delete self[method]
    }
  })

  return this
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='currentRule'>
              <header>
                <h3>currentRule</h3>
                <h4>Atok.prototype.currentRule()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>currentRule</a></p>
                
              </header>

              <section class='params'>
                
                <ul>
                  
                </ul>
              </section>

              

              <section>
                <p>Get the current rule set name</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.currentRule = function () {
  return this._firstRule ? this._firstRule.currentRule : null
}// include(&quot;methods_ruleprops.js&quot;)</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='setDefaultHandler'>
              <header>
                <h3>setDefaultHandler</h3>
                <h4>Atok.prototype.setDefaultHandler()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>setDefaultHandler</a></p>
                
              </header>

              <section class='params'>
                
                  <h4>Params</h4>
                
                <ul>
                  
                    <li>number, - string|null)} rules handler (it is better to name it for debugging)</li>
                  
                </ul>
              </section>

              

              <section>
                <p>Set the default handler. Triggered on all subsequently defined rules if the handler is not supplied</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.setDefaultHandler = function (handler) {
  this._defaultHandler = typeof handler === 'function' ? handler : null
  return this
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='next'>
              <header>
                <h3>next</h3>
                <h4>Atok.prototype.next()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>next</a></p>
                
              </header>

              <section class='params'>
                
                  <h4>Params</h4>
                
                <ul>
                  
                    <li>name - of the rule set to load if rule successful</li>
                  
                    <li>index - to start at</li>
                  
                </ul>
              </section>

              

              <section>
                <p>Skip matched data silently for all subsequent rules</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.next = function (ruleSet, index) {
  this._p_next = typeof ruleSet === 'string' ? ruleSet : null
  this._p_nextIndex = typeof index === 'number' ? index : 0
  return this
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='ignore'>
              <header>
                <h3>ignore</h3>
                <h4>Atok.prototype.ignore()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>ignore</a></p>
                
              </header>

              <section class='params'>
                
                  <h4>Params</h4>
                
                <ul>
                  
                    <li>flag - </li>
                  
                </ul>
              </section>

              

              <section>
                <p>Skip matched data silently for all subsequent rules</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.ignore = function (flag) {
  this._p_ignore = (flag === true)
  return this
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='quiet'>
              <header>
                <h3>quiet</h3>
                <h4>Atok.prototype.quiet()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>quiet</a></p>
                
              </header>

              <section class='params'>
                
                  <h4>Params</h4>
                
                <ul>
                  
                    <li>flag - </li>
                  
                </ul>
              </section>

              

              <section>
                <p>Do not supply matched data to the handler for all subsequent rules. This is used when the token data does not matter but a handler  still needs to be called. Faster than standard handler call.</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.quiet = function (flag) {
  this._p_quiet = (flag === true)
  return this
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='trimLeft'>
              <header>
                <h3>trimLeft</h3>
                <h4>Atok.prototype.trimLeft()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>trimLeft</a></p>
                
              </header>

              <section class='params'>
                
                  <h4>Params</h4>
                
                <ul>
                  
                    <li>flag - </li>
                  
                </ul>
              </section>

              

              <section>
                <p>Remove the left matched pattern for all subsequent rules</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.trimLeft = function (flag) {
  this._p_trimLeft = (flag === true)
  return this
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='trimRight'>
              <header>
                <h3>trimRight</h3>
                <h4>Atok.prototype.trimRight()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>trimRight</a></p>
                
              </header>

              <section class='params'>
                
                  <h4>Params</h4>
                
                <ul>
                  
                    <li>flag - </li>
                  
                </ul>
              </section>

              

              <section>
                <p>Remove the right matched pattern for all subsequent rules If only 1 pattern, it is ignored</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.trimRight = function (flag) {
  this._p_trimRight = (flag === true)
  return this
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='trim'>
              <header>
                <h3>trim</h3>
                <h4>Atok.prototype.trim()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>trim</a></p>
                
              </header>

              <section class='params'>
                
                  <h4>Params</h4>
                
                <ul>
                  
                    <li>flag - </li>
                  
                </ul>
              </section>

              

              <section>
                <p>Remove the left and right matched patterns for all subsequent rules</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.trim = function (flag) {
  return this.trimLeft(flag).trimRight(flag)
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='escape'>
              <header>
                <h3>escape</h3>
                <h4>Atok.prototype.escape()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>escape</a></p>
                
              </header>

              <section class='params'>
                
                  <h4>Params</h4>
                
                <ul>
                  
                    <li>flag - </li>
                  
                </ul>
              </section>

              

              <section>
                <p>Do not remove the left and right matched patterns for all subsequent rules The default escape character is , can be changed by specifying it instead of a Boolean</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.escape = function (flag) {
  this._p_escape = flag === true
    ? '\\'
    : flag &amp;&amp; flag.length &gt; 0
      ? flag.toString(this._encoding || 'utf8').charAt(0)
      : false
  return this
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='continue'>
              <header>
                <h3>continue</h3>
                <h4>Atok.prototype.continue()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>continue</a></p>
                
              </header>

              <section class='params'>
                
                  <h4>Params</h4>
                
                <ul>
                  
                    <li>number - of rules to skip before continuing</li>
                  
                    <li>when - the rule fails, number of rules to skip before continuing</li>
                  
                </ul>
              </section>

              

              <section>
                <p>Continue the rules flow if rule matches at the specified rule index</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.continue = function (jump, jumpOnFail) {
  if (arguments.length === 0) {
    this._p_continue = null
    this._p_continueOnFail = null

    return this
  }

  if ( jump !== null &amp;&amp; !/(number|string|function)/.test(typeof jump) )
    this._error( new Error('Atok#continue: Invalid jump (must be an integer/function/string): ' + jump) )
  
  if (arguments.length === 1)
    jumpOnFail = null
  else if ( jumpOnFail !== null &amp;&amp; !/(number|string|function)/.test(typeof jumpOnFail) )
    this._error( new Error('Atok#continue: Invalid jump (must be an integer/function/string): ' + jumpOnFail) )
  
  this._p_continue = jump
  this._p_continueOnFail = jumpOnFail

  return this
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='break'>
              <header>
                <h3>break</h3>
                <h4>Atok.prototype.break()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>break</a></p>
                
              </header>

              <section class='params'>
                
                <ul>
                  
                </ul>
              </section>

              

              <section>
                <p>Abort a current rule set. Use continue(-1) to resume at the current subrule.</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.break = function (flag) {
  this._p_break = (flag === true)
  return this
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='setProps'>
              <header>
                <h3>setProps</h3>
                <h4>Atok.prototype.setProps()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>setProps</a></p>
                
              </header>

              <section class='params'>
                
                  <h4>Params</h4>
                
                <ul>
                  
                    <li>properties - to be loaded</li>
                  
                </ul>
              </section>

              

              <section>
                <p>Restore properties</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.setProps = function (props) {
  var propNames = Object.keys(props || {})

  for (var prop, i = 0, n = propNames.length; i &lt; n; i++) {
    prop = propNames[i]
    if ( this.hasOwnProperty('_p_' + prop) )
      switch (prop) {
        // Special case: continue has 2 properties
        case 'continue':
          this._p_continue = props[ prop ][0]
          this._p_continueOnFail = props[ prop ][1]
        break
        // Special case: next has 2 properties
        case 'next':
          this._p_next = props[ prop ][0]
          this._p_nextIndex = props[ prop ][1]
        break
        default:
          this[ '_p_' + prop ] = props[ prop ]
      }
  }

  return this
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='clearProps'>
              <header>
                <h3>clearProps</h3>
                <h4>Atok.prototype.clearProps()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>clearProps</a></p>
                
              </header>

              <section class='params'>
                
                <ul>
                  
                </ul>
              </section>

              

              <section>
                <p>Reset properties to their default values</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.clearProps = function () {
// include(&quot;Atok_rule_properties.js&quot;)
  this._p_ignore = false        // Get the token size and skip
  this._p_quiet = false         // Get the token size and call the handler with no data
  this._p_escape = false        // Pattern must not be escaped
  this._p_trimLeft = true       // Remove the left pattern from the token
  this._p_trimRight = true      // Remove the right pattern from the token
  this._p_next = null           // Next rule to load
  this._p_nextIndex = 0         // Index for the next rule to load
  this._p_continue = null       // Next rule index to load
  this._p_continueOnFail = null // Next rule index to load when rule fails
  this._p_break = false         // Abort current rule set
  return this
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='getProps'>
              <header>
                <h3>getProps</h3>
                <h4>Atok.prototype.getProps()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>getProps</a></p>
                
              </header>

              <section class='params'>
                
                <ul>
                  
                </ul>
              </section>

              

              <section>
                <p>Reset properties to their default values</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.getProps = function () {
  // Empty object with no prototype
  var props = Object.create(null)
  var propNames = arguments.length &gt; 0
        ? sliceArguments(arguments, 0)
        : this._defaultProps

  for (var prop, i = 0, num = propNames.length; i &lt; num; i++) {
    prop = propNames[i]
    if ( this.hasOwnProperty('_p_' + prop) )
      switch (prop) {
        // Special case: continue has 2 properties
        case 'continue':
          props[ prop ] = [ this._p_continue, this._p_continueOnFail ]
        break
        // Special case: next has 2 properties
        case 'next':
          props[ prop ] = [ this._p_next, this._p_nextIndex ]
        break
        default:
          props[ prop ] = this[ '_p_' + prop ]
      }
  }

  return props
}
// include(&quot;methods_ruleset.js&quot;)</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='addRuleFirst'>
              <header>
                <h3>addRuleFirst</h3>
                <h4>Atok.prototype.addRuleFirst()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>addRuleFirst</a></p>
                
              </header>

              <section class='params'>
                
                  <h4>Params</h4>
                
                <ul>
                  
                    <li>name - of the rule to be added first</li>
                  
                    <li>rule - item</li>
                  
                    <li>rule - type</li>
                  
                </ul>
              </section>

              

              <section>
                <p>Add a rule as the first one</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.addRuleFirst = function (rule,</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='addRuleBefore'>
              <header>
                <h3>addRuleBefore</h3>
                <h4>Atok.prototype.addRuleBefore()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>addRuleBefore</a></p>
                
              </header>

              <section class='params'>
                
                  <h4>Params</h4>
                
                <ul>
                  
                    <li>name - of the rule to add before</li>
                  
                    <li>rule - item</li>
                  
                    <li>rule - type</li>
                  
                </ul>
              </section>

              

              <section>
                <p>Add a rule before an existing one</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.addRuleBefore = function (existingRule, rule,</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='addRuleAfter'>
              <header>
                <h3>addRuleAfter</h3>
                <h4>Atok.prototype.addRuleAfter()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>addRuleAfter</a></p>
                
              </header>

              <section class='params'>
                
                  <h4>Params</h4>
                
                <ul>
                  
                    <li>name - of the rule to add after</li>
                  
                    <li>rule - item</li>
                  
                    <li>rule - type</li>
                  
                </ul>
              </section>

              

              <section>
                <p>Add a rule after an existing one</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.addRuleAfter = function (existingRule, rule,</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='addRule'>
              <header>
                <h3>addRule</h3>
                <h4>Atok.prototype.addRule()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>addRule</a></p>
                
              </header>

              <section class='params'>
                
                  <h4>Params</h4>
                
                <ul>
                  
                    <li>match - at current buffer position (String: expect string, Integer: expect n characters, Array: expect one of the items). If not needed, use ''</li>
                  
                    <li>rule - name/id (if no default handler set, emit a data event) or handler (executed when all matches are valid). If false, the rule is ignored.</li>
                  
                </ul>
              </section>

              

              <section>
                <p>Add a rule</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.addRule = function (</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='removeRule'>
              <header>
                <h3>removeRule</h3>
                <h4>Atok.prototype.removeRule()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>removeRule</a></p>
                
              </header>

              <section class='params'>
                
                  <h4>Params</h4>
                
                <ul>
                  
                    <li>name - of the rule to be removed</li>
                  
                </ul>
              </section>

              

              <section>
                <p>Remove a rule (first instance only)</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.removeRule = function (</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='clearRule'>
              <header>
                <h3>clearRule</h3>
                <h4>Atok.prototype.clearRule()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>clearRule</a></p>
                
              </header>

              <section class='params'>
                
                <ul>
                  
                </ul>
              </section>

              

              <section>
                <p>Remove all rules</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.clearRule = function () {
  this.clearProps()
  this._firstRule = null
  this._rules = []
  this._defaultHandler = null
  this._rulesToResolve = false

  return this
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='saveRuleSet'>
              <header>
                <h3>saveRuleSet</h3>
                <h4>Atok.prototype.saveRuleSet()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>saveRuleSet</a></p>
                
              </header>

              <section class='params'>
                
                  <h4>Params</h4>
                
                <ul>
                  
                    <li>name - of the rule set</li>
                  
                </ul>
              </section>

              

              <section>
                <p>Save all rules and clear them</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.saveRuleSet = function (name) {
  if (arguments.length === 0 || name === null)
    return this._error( new Error('Atok#saveRuleSet: invalid rule name supplied') )

  this._savedRules[name] = {
    rules: this._rules
      .map(function (rule) {    // Clone and assign the current rule set name
        return rule.clone(name)
      })
  }

  // Resolve and check continues
  this._resolveRules(name)

  return this
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='loadRuleSet'>
              <header>
                <h3>loadRuleSet</h3>
                <h4>Atok.prototype.loadRuleSet()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>loadRuleSet</a></p>
                
              </header>

              <section class='params'>
                
                  <h4>Params</h4>
                
                <ul>
                  
                    <li>name - of the rule set</li>
                  
                    <li>index - to start at</li>
                  
                </ul>
              </section>

              

              <section>
                <p>Load a rule set</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.loadRuleSet = function (name, index) {
  var ruleSet = this._savedRules[name]
  if (!ruleSet)
    return this._error( new Error('Atok#loadRuleSet: Rule set ' + name + ' not found') )

  index = typeof index === 'number' ? index : 0

  this._rules = ruleSet.rules
  // Set the rule index
  this._firstRule = this._rules[index]
  this._resetRule = true

  return this
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='removeRuleSet'>
              <header>
                <h3>removeRuleSet</h3>
                <h4>Atok.prototype.removeRuleSet()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>removeRuleSet</a></p>
                
              </header>

              <section class='params'>
                
                  <h4>Params</h4>
                
                <ul>
                  
                    <li>name - of the rule set</li>
                  
                </ul>
              </section>

              

              <section>
                <p>Delete a rule set</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.removeRuleSet = function (name) {
  delete this._savedRules[name]

  return this
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='groupRule'>
              <header>
                <h3>groupRule</h3>
                <h4>Atok.prototype.groupRule()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>groupRule</a></p>
                
              </header>

              <section class='params'>
                
                  <h4>Params</h4>
                
                <ul>
                  
                    <li>toggle - grouping on/off</li>
                  
                </ul>
              </section>

              

              <section>
                <p>Bind rules to the same index</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.groupRule = function (flag) {
  var rules = this._rules

  if (flag) {
    this._group++
    this._groupStartPrev.push(this._groupStart)
    this._groupStart = rules.length

    return this
  }

  // Ignore invalid groupRule()
  if (this._group &lt; 0) return this
  
  // 1 or 0 rule within the group, ignored it
  if (rules.length - this._groupStart &lt; 2) {
    for (var i = this._groupStart, n = rules.length; i &lt; n; i++) {
      rules[i].group = -1
      rules[i].groupStart = 0
      rules[i].groupEnd = 0
    }
  } else {
    // Set the last index of the group to all rules belonging to the current group
    for (var i = this._groupStart, n = rules.length; i &lt; n; i++)
      if (rules[i].group === this._group)
        rules[i].groupEnd = n - 1
  }

  this._group--
  this._groupStart = this._groupStartPrev.pop() || 0
  this._groupEnd = 0

  return this
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='write'>
              <header>
                <h3>write</h3>
                <h4>Atok.prototype.write()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>write</a></p>
                
              </header>

              <section class='params'>
                
                  <h4>Params</h4>
                
                <ul>
                  
                    <li>data - to be processed</li>
                  
                </ul>
              </section>

              

              <section>
                <p>Applies the current rules to the incoming data. When false is returned (the tokenizer is paused), the data is buffered but no processing occurs until the tokenizer is resumed.</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.write = function (data) {
  if (this.ended) {
    this._error( new Error('Atok#write: write after end') )
    return false
  }

  if (!data || data.length === 0) return true

  // Setting the encoding by default when receiving a string
  if ( typeof data === 'string' &amp;&amp; !this._encoding ) this.setEncoding('utf-8')

  // Buffer the incoming data...
  if (this.length &gt; 0) {
    // Process strings and Buffers separately
    if ( this._encoding ) {
      this.buffer += this._stringDecoder.write( data.toString() )
    } else {
      this.buffer = this.buffer.concat(data)
      // this.buffer = Buffer.concat( [ this.buffer, data ], this.length )
    }
  } else {
    this.buffer = this._encoding ? data.toString() : data
  }
  this.length = this.buffer.length

  // Check rules resolution (pause __can__ be called before write)
  if (this._rulesToResolve) this._resolveRules() // Does linking too
  // No resolution but linking may be required
  else if (this._rulesToLink) this._linkRules()

  // ... hold on until tokenization completed on the current data set
  // or consume the data
  if (this.paused) {
    this.needDrain = true
    return false
  }

  return this._tokenize()
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='end'>
              <header>
                <h3>end</h3>
                <h4>Atok.prototype.end()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>end</a></p>
                
              </header>

              <section class='params'>
                
                  <h4>Params</h4>
                
                <ul>
                  
                    <li>data - to be processed</li>
                  
                </ul>
              </section>

              

              <section>
                <p>Ends the stream and emit the <code>end</code> event. Any remaining data is passed to  the listeners.</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.end = function (data) {
  this.ending = true
  this.write(data)
  this.ended = true
  this.ending = false

  this.readable = false
  this.writable = false

  this._end()
  return this
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='pause'>
              <header>
                <h3>pause</h3>
                <h4>Atok.prototype.pause()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>pause</a></p>
                
              </header>

              <section class='params'>
                
                <ul>
                  
                </ul>
              </section>

              

              <section>
                <p>Pauses the stream - data is buffered until the   stream is resumed with <code>Atok#resume()</code></p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.pause = function () {
  this.paused = true
  return this
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='resume'>
              <header>
                <h3>resume</h3>
                <h4>Atok.prototype.resume()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>resume</a></p>
                
              </header>

              <section class='params'>
                
                <ul>
                  
                </ul>
              </section>

              

              <section>
                <p>Resumes the stream - buffered data is immediately processed</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.resume = function () {
  this.paused = false
  return this._tokenize()
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='destroy'>
              <header>
                <h3>destroy</h3>
                <h4>Atok.prototype.destroy()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>destroy</a></p>
                
              </header>

              <section class='params'>
                
                <ul>
                  
                </ul>
              </section>

              

              <section>
                <p>Placeholder for <code>Atok#destroy()</code></p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype.destroy = function () {
  this.readable = false
  this.writable = false
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='_end'>
              <header>
                <h3>_end</h3>
                <h4>Atok.prototype._end()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>_end</a></p>
                
              </header>

              <section class='params'>
                
                <ul>
                  
                </ul>
              </section>

              

              <section>
                <p>End a stream by emitting the <code>end</code> event with remaining data</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype._end = function () {
  this.emit_end( this.buffer, -1, this.currentRule )
  this.clear()
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='_done'>
              <header>
                <h3>_done</h3>
                <h4>Atok.prototype._done()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>_done</a></p>
                
              </header>

              <section class='params'>
                
                <ul>
                  
                </ul>
              </section>

              

              <section>
                <p>End of <code>Atok#write()</code>: emit the <code>drain</code> event if required</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype._done = function () {
  if (this.needDrain) {
    this.needDrain = false
    this.emit_drain()
  }

  if (this.ended) {
    this._end()
    return false
  }

  return true
}</code></pre>
              </section>
              
            </section>
          
            <section class='method' id='_tokenize'>
              <header>
                <h3>_tokenize</h3>
                <h4>Atok.prototype._tokenize()</h4>
                <p class='type'>method</p>
                
                  <p class='related'>See: <a href='#'>_tokenize</a></p>
                
              </header>

              <section class='params'>
                
                <ul>
                  
                </ul>
              </section>

              

              <section>
                <p>The core of Atok. Loops through the rules and check them against the data, calling handler or emitting the <code>data</code> event and branching appropriately.</p>
              </section>

              <section class='source'>
                <h4>Source</h4>
                <pre><code>Atok.prototype._tokenize = function () {
  // NB. Rules and buffer can be reset by the token handler
  var p, props, matched
  var token

  p = this._firstRule
  this._resetRule = false

  while ( p &amp;&amp; this.offset &lt; this.length ) {
    props = p.props

    // Return the size of the matched data (0 is valid!)
    matched = p.test(this.buffer, this.offset)

    if ( matched &lt; 0 ) {
      // End of the rule set, end the loop
      if (!p.nextFail) break

      // Next rule exists, carry on
      p = p.nextFail
      continue
    }

    // Is the token to be processed?
    if ( props.ignore ) {
      p = p.next
    } else {
      // Emit the data by default, unless the handler is set
      token = props.quiet
        ? matched - (p.single ? 0 : p.last.length) - p.first.length
        : this.buffer.slice(
            this.offset + p.first.length
          , this.offset + matched - (p.single ? 0 : p.last.length)
          )

      if (p.handler) p.handler(token, p.last.idx, p.type)
      else this.emit_data(token, p.last.idx, p.type)

      // Handler has changed rules, resolve and relink
      if (this._rulesToResolve) this._resolveRules()

      // RuleSet may have be changed by the handler
      if (this._resetRule) {
        this._resetRule = false
        p = this._firstRule
      } else {
        p = p.next
      }
    }

    this.offset += matched

    // NB. `break()` prevails over `pause()`
    if (props.break) break

    // Hold on if the stream was paused
    if (this.paused) {
      this._firstRule = p
      this.needDrain = true
      return false
    }
  }

  // Keep track of the rule we are at
  if (p) this._firstRule = p

  // Truncate the buffer if possible: min(offset, markedOffset)
  if (this.markedOffset &lt; 0) {
    // No marked offset or beyond the current offset
    if (this.offset === this.length) {
      this.offset = 0
      this.buffer = null
      this.length = 0
      this.emit_empty(this.ending)

    } else if (this.offset &lt; this.length) {
      this.buffer = this.buffer.slice(this.offset)
      this.length = this.buffer.length
      this.offset = 0

    } else {
      // Can only occurs if offset was manually incremented
      this.offset = this.offset - this.length
      this.buffer = null
      this.length = 0
    }

  } else {
    var maxOffset = 'markedOffset'
    var minOffset = 'offset'
    var _

    if (this.markedOffset &lt; this.offset) {
      _ = maxOffset
      maxOffset = minOffset
      minOffset = _
    }

    if (this[minOffset] === this.length) {
      this[maxOffset] -= this[minOffset]
      this[minOffset] = 0
      this.buffer = null
      this.length = 0
      this.emit_empty(this.ending)

    } else if (this[minOffset] &lt; this.length) {
      this[maxOffset] -= this[minOffset]
      this.buffer = this.buffer.slice(this[minOffset])
      this.length = this.buffer.length
      this[minOffset] = 0

    } else {
      // Can only occurs if offset was manually incremented
      this[maxOffset] -= this.length
      this[minOffset] -= this.length
      this.buffer = null
      this.length = 0
    }
  }

  return this._done()
}</code></pre>
              </section>
              
            </section>
          
        </article>
      
    </div>
  </div>
  <script>
    (function (hijs) {
    //
    // hijs - JavaScript Syntax Highlighter
    //
    // Copyright (c) 2010 Alexis Sellier
    //

    // All elements which match this will be syntax highlighted.
    var selector = hijs || 'code';

    var keywords = ('var function if else for while break switch case do new null in with void '
                   +'continue delete return this true false throw catch typeof with instanceof').split(' '),
        special  = ('eval window document undefined NaN Infinity parseInt parseFloat '
                   +'encodeURI decodeURI encodeURIComponent decodeURIComponent').split(' ');

    // Syntax definition
    // The key becomes the class name of the <span>
    // around the matched block of code.
    var syntax = [
      ['comment', /(\/\*(?:[^*\n]|\*+[^\/*])*\*+\/)/g],
      ['comment', /(\/\/[^\n]*)/g],
      ['string' , /("(?:(?!")[^\\\n]|\\.)*"|'(?:(?!')[^\\\n]|\\.)*')/g],
      ['regexp' , /(\/.+\/[mgi]*)(?!\s*\w)/g],
      ['class'  , /\b([A-Z][a-zA-Z]+)\b/g],
      ['number' , /\b([0-9]+(?:\.[0-9]+)?)\b/g],
      ['keyword', new(RegExp)('\\b(' + keywords.join('|') + ')\\b', 'g')],
      ['special', new(RegExp)('\\b(' + special.join('|') + ')\\b', 'g')]
    ];
    var nodes, table = {};

    if (/^[a-z]+$/.test(selector)) {
        nodes = document.getElementsByTagName(selector);
    } else if (/^\.[\w-]+$/.test(selector)) {
        nodes = document.getElementsByClassName(selector.slice(1));
    } else if (document.querySelectorAll) {
        nodes = document.querySelectorAll(selector);
    } else {
        nodes = [];
    }

    for (var i = 0, children; i < nodes.length; i++) {
        children = nodes[i].childNodes;

        for (var j = 0, str; j < children.length; j++) {
            code = children[j];

            if (code.length >= 0) { // It's a text node
                // Don't highlight command-line snippets
                if (! /^\$/.test(code.nodeValue.trim())) {
                    syntax.forEach(function (s) {
                        var k = s[0], v = s[1];
                        code.nodeValue = code.nodeValue.replace(v, function (_, m) {
                            return '\u00ab' + encode(k) + '\u00b7'
                                            + encode(m) +
                                   '\u00b7' + encode(k) + '\u00bb';
                        });
                    });
                }
            }
        }
    }
    for (var i = 0; i < nodes.length; i++) {
        nodes[i].innerHTML =
            nodes[i].innerHTML.replace(/\u00ab(.+?)\u00b7(.+?)\u00b7\1\u00bb/g, function (_, name, value) {
                value = value.replace(/\u00ab[^\u00b7]+\u00b7/g, '').replace(/\u00b7[^\u00bb]+\u00bb/g, '');
                return '<span class="' + decode(name) + '">' + escape(decode(value)) + '</span>';
        });
    }

    function escape(str) {
        return str.replace(/</g, '&lt;').replace(/>/g, '&gt;');
    }

    // Encode ASCII characters to, and from Braille
    function encode (str, encoded) {
        table[encoded = str.split('').map(function (s) {
            if (s.charCodeAt(0) > 127) { return s }
            return String.fromCharCode(s.charCodeAt(0) + 0x2800);
        }).join('')] = str;
        return encoded;
    }
    function decode (str) {
        if (str in table) {
            return table[str];
        } else {
            return str.trim().split('').map(function (s) {
                if (s.charCodeAt(0) - 0x2800 > 127) { return s }
                return String.fromCharCode(s.charCodeAt(0) - 0x2800);
            }).join('');
        }
    }

    })(window.hijs);
  </script>
</body>
